// @flow

import React from 'react';
import { View } from 'react-native';

import { useStyles } from '../styles';
import type { Props } from './CountryFlag.types';
import { baseURL, CODES } from './CountryFlag.consts';
import { Image } from '../Image';
import { testAttribute } from '../common/testUtils';

export function getCountry(code: ?string) {
  const codeNormalized = code ? code.toLowerCase() : 'anywhere';
  const countryCodeExists = CODES.includes(codeNormalized);
  // @TODO add warning "Country code not supported" (as described here: https://github.com/kiwicom/orbit-components/blob/master/src/CountryFlag/index.js)
  const countryCode = countryCodeExists ? codeNormalized : 'anywhere';
  return countryCode;
}

export function CountryFlag({ dataTest, code, name }: Props) {
  const country = getCountry(code);
  return (
    <View style={useStyles({ base: 'container' })}>
      <Image
      title={name}
      alt={name}
      source={{
        '1': `${baseURL}/flags/24x0/flag-${country}.jpg`,
        '2': `${baseURL}/flags/48x0/flag-${country}.jpg` }}

      style={useStyles({ base: 'image' })}
      {...testAttribute(dataTest)} />

      <View style={useStyles({ base: 'shadow' })} />
    </View>);

}

// Display name for Storybook
CountryFlag.displayName = 'CountryFlag';