// @flow

import React from 'react';
import type { Node as ReactNode } from 'react';
import {
SafeAreaView as RNSafeAreaView,
ScrollView as RNScrollView,
View as RNView,
Modal as RNModal } from
'react-native';

import { ThemeContext } from '../ThemeProvider/ThemeContext';
import { capitalize } from '../common/utils';
import { testAttribute } from '../common/testUtils';

type Props = {|
  +size?: 'small' | 'normal' | 'large',
  +isMobileFullPage?: boolean,
  +dataTest?: string,
  +children?: ReactNode, |};


export function Modal({ size = 'normal', isMobileFullPage = false, dataTest, children }: Props) {
  const [theme] = React.useContext(ThemeContext);
  const borderRadiusModal = isMobileFullPage ? 9 : 0; // @TODO theme.orbit.borderRadiusModal

  // @TODO Instead of nested <RNModal>s, a single <RNModal> with some extra animations on a <RNView> inside should do much better.
  return (
    <RNModal animationType="fade" transparent={true} visible={true}>
      <RNView
      style={{
        position: 'absolute',
        width: '100%',
        height: '100%',
        backgroundColor: 'rgba(0, 0, 0, 0.5)' }}>


        <RNModal animationType="slide" transparent={true} visible={true}>
          <RNSafeAreaView style={{ flex: 1 }}>
            <RNScrollView
            style={{
              flex: 1,
              flexDirection: 'column',
              backgroundColor: theme.orbit.backgroundModal,
              borderTopLeftRadius: borderRadiusModal,
              borderTopRightRadius: borderRadiusModal }}

            contentContainerStyle={{
              justifyContent: 'center',
              alignItems: 'center' }}

            nestedScrollEnabled={true}
            {...testAttribute(dataTest)}>

              <RNView
              style={{
                flex: 1,
                width: parseFloat(theme.orbit[`widthModal${capitalize(size)}`]),
                maxWidth: '100%' }}>


                {children}
              </RNView>
            </RNScrollView>
          </RNSafeAreaView>
        </RNModal>
      </RNView>
    </RNModal>);

}

// Display name for Storybook
Modal.displayName = 'Modal';